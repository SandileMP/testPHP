
(function OpusMediaWorkerUMD(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["encoderWorker"] = factory();
	else
		root["encoderWorker"] = factory();
})(typeof OpusMediaRecorder !== 'undefined' ? OpusMediaRecorder : typeof self !== 'undefined' ? self : this, function() {
return function() {!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var f=function(){function e(t,n,r,o){switch(u(this,e),this._size=n,this._module=t,this._size){case 1:this._heapArray=r?this._module.HEAP8:this._module.HEAPU8;break;case 2:this._heapArray=r?this._module.HEAP16:this._module.HEAPU16;break;case 4:this._heapArray=r?this._module.HEAP32:this._module.HEAPU32;break;default:this._heapArray=this._module.HEAPU8}o&&(this._size=4,this._heapArray=this._module.HEAPF32),this._pointer=this._module._malloc(n)}return c(e,[{key:"free",value:function(){this._module._free(this.pointer)}},{key:"pointer",get:function(){return this._pointer}},{key:"value",get:function(){var e=0;switch(this._size){case 2:e=1;break;case 4:e=2;break;default:throw new Error("Pointer can be only deferenced as integer-sized")}return this._heapArray[this.pointer>>e]},set:function(e){var t=0;switch(this._size){case 2:t=1;break;case 4:t=2;break;default:throw new Error("Pointer can be only deferenced as integer-sized")}this._heapArray[this.pointer>>t]=e}}]),e}(),l=function(e){function t(e,n){var i;return u(this,t),i=r(this,o(t).call(this,e,4,!0,!1)),void 0!==n&&(i.value=n),i}return i(t,f),t}(),p=function(e){function t(e,n){var i;return u(this,t),i=r(this,o(t).call(this,e,4,!1,!1)),void 0!==n&&(i.value=n),i}return i(t,f),t}(),d=function(e){function t(e,n,i,a,s){var c;u(this,t),c=r(this,o(t).call(this,e,n*i,a,s));var f=0;switch(i){case 1:c._heapArray=a?c._module.HEAP8:c._module.HEAPU8,f=0;break;case 2:c._heapArray=a?c._module.HEAP16:c._module.HEAPU16,f=1;break;case 4:c._heapArray=a?c._module.HEAP32:c._module.HEAPU32,f=2;break;default:throw new Error("Unit size must be an integer-size")}s&&(c._heapArray=c._module.HEAPF32,f=2);var l=c._pointer>>f;return c._buffer=c._heapArray.subarray(l,l+n),c._length=n,c}return i(t,f),c(t,[{key:"set",value:function(e,t){this._buffer.set(e,t)}},{key:"subarray",value:function(e,t){return this._buffer.subarray(e,t)}},{key:"length",get:function(){return this._length}}]),t}(),h=function(e){function t(e,n){return u(this,t),r(this,o(t).call(this,e,n,4,!0,!0))}return i(t,d),t}(),m=function(e){function t(e,n){return u(this,t),r(this,o(t).call(this,e,n,1,!1,!1))}return i(t,d),t}(),y=function(){function e(t){u(this,e),this._module=t}return c(e,[{key:"mallocInt32",value:function(e){return new l(this._module,e)}},{key:"mallocUint32",value:function(e){return new p(this._module,e)}},{key:"mallocUint8Buffer",value:function(e){return new m(this._module,e)}},{key:"mallocFloat32Buffer",value:function(e){return new h(this._module,e)}}]),e}();e.exports={writeString:function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))},EmscriptenMemoryAllocator:y}},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,c=[],f=!1,l=-1;function p(){f&&s&&(f=!1,s.length?c=s.concat(c):l=-1,c.length&&d())}function d(){if(!f){var e=u(p);f=!0;for(var t=c.length;t;){for(s=c,c=[];++l<t;)s&&s[l].run();l=-1,t=c.length}s=null,f=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||f||u(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",o=!1,i=arguments.length-1;i>=-1&&!o;i--){var a=i>=0?arguments[i]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,o="/"===a.charAt(0))}return(o?"/":"")+(t=n(r(t.split("/"),function(e){return!!e}),!o).join("/"))||"."},t.normalize=function(e){var i=t.isAbsolute(e),a="/"===o(e,-1);return(e=n(r(e.split("/"),function(e){return!!e}),!i).join("/"))||i||(e="."),e&&a&&(e+="/"),(i?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var o=r(e.split("/")),i=r(n.split("/")),a=Math.min(o.length,i.length),u=a,s=0;s<a;s++)if(o[s]!==i[s]){u=s;break}var c=[];for(s=u;s<o.length;s++)c.push("..");return(c=c.concat(i.slice(u))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,o=!0,i=e.length-1;i>=1;--i)if(47===(t=e.charCodeAt(i))){if(!o){r=i;break}}else o=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,o=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){n=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,o=!0,i=0,a=e.length-1;a>=0;--a){var u=e.charCodeAt(a);if(47!==u)-1===r&&(o=!1,r=a+1),46===u?-1===t?t=a:1!==i&&(i=1):-1!==t&&(i=-1);else if(!o){n=a+1;break}}return-1===t||-1===r||0===i||1===i&&t===r-1&&t===n+1?"":e.slice(t,r)};var o="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(1))},function(e,t,n){function r(e){var t,r=n(6),o=n(7),i=n(8);e.onmessage=function(e){var n=e.data.command;switch(n){case"loadEncoder":var a,u=e.data,s=u.mimeType,c=u.wasmPath;switch(s){case"audio/wav":case"audio/wave":a=r;break;case"audio/webm":case"video/webm":a=o;break;case"audio/ogg":a=i}var f={};c&&(f.locateFile=function(e,t){return e.match(/.wasm/)?c:t+e}),a(f).then(function(e){t=e,self.postMessage({command:"readyToInit"})});break;case"init":var l=e.data,p=l.sampleRate,d=l.channelCount,h=l.audioBitsPerSecond,m=l.videoBitsPerSecond,y=l.width,_=l.height,v=l.framerate;t.init({sampleRate:p,channelCount:d,audioBitsPerSecond:h,videoBitsPerSecond:m,width:y,height:_,framerate:v});break;case"pushInputData":for(var b=e.data,g=b.channelBuffers,w=(b.length,b.duration,0);w<g.length;w++)g[w]=new Float32Array(g[w].buffer);t.encode(g);break;case"pushVideoData":var A=e.data.videoData;t&&t.encodeVideoFrame(A);break;case"getEncodedData":case"done":"done"===n&&t.close();var S=t.flush();self.postMessage({command:"done"===n?"lastEncodedData":"encodedData",buffers:S},S),"done"===n&&self.close()}}}"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&r(self),e.exports=r},function(e,t,n){function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(0).writeString,a=Int16Array.BYTES_PER_ELEMENT,u=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config={inputSampleRate:t,channelCount:n},this.encodedBuffers=[]}var t,n,r;return t=e,(n=[{key:"encode",value:function(e){for(var t=e[0].length,n=new ArrayBuffer(t*a*this.config.channelCount),r=new DataView(n),o=0;o<this.config.channelCount;o++)for(var i=e[o],u=0;u<t;u++){var s=32767*i[u]|0;s>32767?s=32767:s<-32768&&(s=-32768);var c=(u*this.config.channelCount+o)*a;r.setInt16(c,0|s,!0)}this.encodedBuffers.push(n)}},{key:"getHeader",value:function(){var e=this.encodedBuffers.reduce(function(e,t){return e+t.byteLength},0),t=new ArrayBuffer(44),n=new DataView(t);return i(n,0,"RIFF"),n.setUint32(4,36+e,!0),i(n,8,"WAVE"),i(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,this.config.channelCount,!0),n.setUint32(24,this.config.inputSampleRate,!0),n.setUint32(28,this.config.inputSampleRate*a*this.config.channelCount,!0),n.setUint16(32,a*this.config.channelCount,!0),n.setUint16(34,8*a,!0),i(n,36,"data"),n.setUint32(40,e,!0),t}}])&&o(t.prototype,n),r&&o(t,r),e}();e.exports=function(e){return new Promise(function(t,n){(e=void 0!==e&&e||{}).init=function(t,n,r){e.encoder=new u(t,n,r)},e.encode=function(t){e.encoder.encode(t)},e.flush=function(){var t=e.encoder.getHeader(),n=e.encoder.encodedBuffers.splice(0,e.encoder.encodedBuffers.length);return[t].concat(r(n))},e.close=function(){},t(e)})}},function(e,t,n){(function(e,r,o){var i;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var f,l=(f="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){t=void 0!==(t=t||{})?t:{};var o=n(0),i=o.EmscriptenMemoryAllocator,s=2049,l=48e3,p=4e3,d=20,h=6,m=4,y=4096,_=0,v=4002,b=0,g=function(){function e(n){u(this,e);var r=n.sampleRate,o=n.channelCount,a=n.audioBitsPerSecond,s=n.videoBitsPerSecond,c=n.width,f=n.height,h=n.framerate;this.config={sampleRate:r,channelCount:o,width:c,height:f,framerate:h},this.memory=new i(t),o>0&&(this._opus_encoder_create=t._opus_encoder_create,this._opus_encoder_ctl=t._opus_encoder_ctl,this._opus_encode_float=t._opus_encode_float,this._opus_encoder_destroy=t._opus_encoder_destroy,this._speex_resampler_init=t._speex_resampler_init,this._speex_resampler_process_interleaved_float=t._speex_resampler_process_interleaved_float,this._speex_resampler_destroy=t._speex_resampler_destroy),this._container=new t.Container,this._container.initVideo(1,h,c,f,s),o>0&&(this._container.initAudio(l,o,Math.floor(4294967295*Math.random())),this.OpusInitCodec(l,o,a),this.SpeexInitResampler(r,l,o),this.inputSamplesPerChannel=r*d/1e3,this.outputSamplePerChannel=l*d/1e3),this.videoBuffer=this.memory.mallocUint8Buffer(c*f*m),o>0&&(this.inputBufferIndex=0,this.mInputBuffer=this.memory.mallocFloat32Buffer(this.inputSamplesPerChannel*o),this.mResampledBuffer=this.memory.mallocFloat32Buffer(this.outputSamplePerChannel*o),this.mOutputBuffer=this.memory.mallocUint8Buffer(p),this.interleavedBuffers=1!==o?new Float32Array(y*o):void 0)}return c(e,[{key:"encode",value:function(e){for(var t=this.interleave(e),n=0;n<t.length;){var r=Math.min(this.mInputBuffer.length-this.inputBufferIndex,t.length-n);if(this.mInputBuffer.set(t.subarray(n,n+r),this.inputBufferIndex),this.inputBufferIndex+=r,this.inputBufferIndex>=this.mInputBuffer.length){var o=this.memory.mallocUint32(this.inputSamplesPerChannel),i=this.memory.mallocUint32(this.outputSamplePerChannel),a=this._speex_resampler_process_interleaved_float(this.resampler,this.mInputBuffer.pointer,o.pointer,this.mResampledBuffer.pointer,i.pointer);if(o.free(),i.free(),a!==b)throw new Error("Resampling error.");var u=this._opus_encode_float(this.encoder,this.mResampledBuffer.pointer,this.outputSamplePerChannel,this.mOutputBuffer.pointer,this.mOutputBuffer.length);if(u<0)throw new Error("Opus encoding error.");this._container.writeAudioFrame(this.mOutputBuffer.pointer,u,this.outputSamplePerChannel),this.inputBufferIndex=0}n+=r}}},{key:"encodeVideoFrame",value:function(e){this.videoBuffer.set(new Uint8Array(e.slice(0)),0),this._container.writeVideoFrame(this.videoBuffer.pointer)}},{key:"close",value:function(){for(var e=this.config.channelCount,n=[],r=0;r<e;++r)n.push(new Float32Array(y-this.inputBufferIndex/e));e>0&&this.encode(n),t.destroy(this._container),this.videoBuffer.free(),e>0&&(this.mInputBuffer.free(),this.mResampledBuffer.free(),this.mOutputBuffer.free(),this._opus_encoder_destroy(this.encoder),this._speex_resampler_destroy(this.resampler))}},{key:"interleave",value:function(e){var t=e.length;if(1===t)return e[0];for(var n=0;n<t;n++)for(var r=e[n],o=0;o<r.length;o++)this.interleavedBuffers[o*t+n]=r[o];return this.interleavedBuffers}},{key:"OpusInitCodec",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=this.memory.mallocUint32(void 0);this.encoder=this._opus_encoder_create(e,t,s,r.pointer);var o=r.value;if(r.free(),o!==_)throw new Error("Opus encodor initialization failed.");n&&this.OpusSetOpusControl(v,n)}},{key:"OpusSetOpusControl",value:function(e,t){var n=this.memory.mallocInt32(t);this._opus_encoder_ctl(this.encoder,e,n.pointer),n.free()}},{key:"SpeexInitResampler",value:function(e,t,n){var r=this.memory.mallocUint32(void 0);this.resampler=this._speex_resampler_init(n,e,t,h,r.pointer);var o=r.value;if(r.free(),o!==b)throw new Error("Initializing resampler failed.")}}]),e}();t.init=function(e){var n=e.sampleRate,r=e.channelCount,o=e.audioBitsPerSecond,i=e.videoBitsPerSecond,a=e.width,u=e.height,s=e.framerate;t.encodedBuffers=[],t.encoder=new g({sampleRate:n,channelCount:r,audioBitsPerSecond:o,videoBitsPerSecond:i,width:a,height:u,framerate:s})},t.encode=function(e){t.encoder.encode(e)},t.encodeVideoFrame=function(e){t.encoder&&t.encoder.encodeVideoFrame(e)},t.flush=function(){return t.encodedBuffers.splice(0,t.encodedBuffers.length)},t.close=function(){t.encoder.close()};var w,A={};for(w in t)t.hasOwnProperty(w)&&(A[w]=t[w]);t.arguments=[],t.thisProgram="./this.program",t.quit=function(e,t){throw t},t.preRun=[],t.postRun=[];var S=!1,B=!1,C=!1,E=!1;S="object"===("undefined"==typeof window?"undefined":a(window)),B="function"==typeof importScripts,C="object"===(void 0===e?"undefined":a(e))&&!S&&!B,E=!S&&!C&&!B;var P,R,j="";function O(e){return t.locateFile?t.locateFile(e,j):j+e}C?(j=r+"/",t.read=function(e,t){var r;return P||(P=n(3)),R||(R=n(4)),e=R.normalize(e),r=P.readFileSync(e),t?r:r.toString()},t.readBinary=function(e){var n=t.read(e,!0);return n.buffer||(n=new Uint8Array(n)),L(n.buffer),n},e.argv.length>1&&(t.thisProgram=e.argv[1].replace(/\\/g,"/")),t.arguments=e.argv.slice(2),e.on("uncaughtException",function(e){if(!(e instanceof Nt))throw e}),e.on("unhandledRejection",Xt),t.quit=function(t){e.exit(t)},t.inspect=function(){return"[Emscripten Module object]"}):E?("undefined"!=typeof read&&(t.read=function(e){return read(e)}),t.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(L("object"===a(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?t.arguments=scriptArgs:void 0!==arguments&&(t.arguments=arguments),"function"==typeof quit&&(t.quit=function(e){quit(e)})):(S||B)&&(B?j=self.location.href:document.currentScript&&(j=document.currentScript.src),f&&(j=f),j=0!==j.indexOf("blob:")?j.substr(0,j.lastIndexOf("/")+1):"",t.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},B&&(t.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),t.readAsync=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},t.setWindowTitle=function(e){document.title=e});var T=t.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),x=t.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||T);for(w in A)A.hasOwnProperty(w)&&(t[w]=A[w]);A=void 0;var I,F={"f64-rem":function(e,t){return e%t},debugger:function(){}},k=(new Array(0),0),M=function(e){k=e},U=function(){return k};"object"!==("undefined"==typeof WebAssembly?"undefined":a(WebAssembly))&&x("no native wasm support detected");var V=!1;function L(e,t){e||Xt("Assertion failed: "+t)}var D="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function H(e,t,n){for(var r=t+n,o=t;e[o]&&!(o>=r);)++o;if(o-t>16&&e.subarray&&D)return D.decode(e.subarray(t,o));for(var i="";t<o;){var a=e[t++];if(128&a){var u=63&e[t++];if(192!=(224&a)){var s=63&e[t++];if((a=224==(240&a)?(15&a)<<12|u<<6|s:(7&a)<<18|u<<12|s<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var c=a-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&a)<<6|u)}else i+=String.fromCharCode(a)}return i}function W(e,t){return e?H(K,e,t):""}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var z,q,K,N,G=16384,X=65536;function Y(e,t){return e%t>0&&(e+=t-e%t),e}function J(){t.HEAP8=q=new Int8Array(z),t.HEAP16=new Int16Array(z),t.HEAP32=N=new Int32Array(z),t.HEAPU8=K=new Uint8Array(z),t.HEAPU16=new Uint16Array(z),t.HEAPU32=new Uint32Array(z),t.HEAPF32=new Float32Array(z),t.HEAPF64=new Float64Array(z)}var Z=5335088,Q=92176,$=5242880,ee=t.TOTAL_MEMORY||16777216;function te(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var r=n.func;"number"==typeof r?void 0===n.arg?t.dynCall_v(r):t.dynCall_vi(r,n.arg):r(void 0===n.arg?null:n.arg)}else n()}}ee<$&&x("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+ee+"! (TOTAL_STACK="+$+")"),t.buffer?z=t.buffer:"object"===("undefined"==typeof WebAssembly?"undefined":a(WebAssembly))&&"function"==typeof WebAssembly.Memory?(I=new WebAssembly.Memory({initial:ee/X}),z=I.buffer):z=new ArrayBuffer(ee),J(),N[Q>>2]=Z;var ne=[],re=[],oe=[],ie=[],ae=!1;function ue(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)le(t.preRun.shift());te(ne)}function se(){ae||(ae=!0,te(re))}function ce(){te(oe)}function fe(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)de(t.postRun.shift());te(ie)}function le(e){ne.unshift(e)}function pe(e){oe.unshift(e)}function de(e){ie.unshift(e)}var he=Math.cos,me=Math.sin,ye=0,_e=null,ve=null;function be(e){ye++,t.monitorRunDependencies&&t.monitorRunDependencies(ye)}function ge(e){if(ye--,t.monitorRunDependencies&&t.monitorRunDependencies(ye),0==ye&&(null!==_e&&(clearInterval(_e),_e=null),ve)){var n=ve;ve=null,n()}}t.preloadedImages={},t.preloadedAudios={};var we="data:application/octet-stream;base64,";function Ae(e){return String.prototype.startsWith?e.startsWith(we):0===e.indexOf(we)}var Se="WebMOpusEncoder.wasm";function Be(){try{if(t.wasmBinary)return new Uint8Array(t.wasmBinary);if(t.readBinary)return t.readBinary(Se);throw"both async and sync fetching of the wasm failed"}catch(e){Xt(e)}}function Ce(){return t.wasmBinary||!S&&!B||"function"!=typeof fetch?new Promise(function(e,t){e(Be())}):fetch(Se,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Se+"'";return e.arrayBuffer()}).catch(function(){return Be()})}function Ee(e){var n={env:e,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:F};function r(e,n){var r=e.exports;t.asm=r,ge()}if(be(),t.instantiateWasm)try{return t.instantiateWasm(n,r)}catch(e){return x("Module.instantiateWasm callback failed with error: "+e),!1}function o(e){r(e.instance)}function i(e){Ce().then(function(e){return WebAssembly.instantiate(e,n)}).then(e,function(e){x("failed to asynchronously prepare wasm: "+e),Xt(e)})}return t.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||Ae(Se)||"function"!=typeof fetch?i(o):WebAssembly.instantiateStreaming(fetch(Se,{credentials:"same-origin"}),n).then(o,function(e){x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),i(o)}),{}}function Pe(e,n){var r=new Uint8Array(t.HEAPU8.buffer,e,n);t.encodedBuffers.push(new Uint8Array(r).buffer)}function Re(e,t,n,r){Xt("Assertion failed: "+W(e)+", at: "+[t?W(t):"unknown filename",n,r?W(r):"unknown function"])}function je(){throw V=!0,"Pure virtual function called!"}function Oe(){}Ae(Se)||(Se=O(Se)),t.asm=function(e,t,n){return t.memory=I,t.table=new WebAssembly.Table({initial:332,maximum:332,element:"anyfunc"}),t.__memory_base=1024,t.__table_base=0,Ee(t)};var Te={buffers:[null,[],[]],printChar:function(e,t){var n=Te.buffers[e];0===t||10===t?((1===e?T:x)(H(n,0)),n.length=0):n.push(t)},varargs:0,get:function(e){return Te.varargs+=4,N[Te.varargs-4>>2]},getStr:function(){return W(Te.get())},get64:function(){var e=Te.get();return Te.get(),e},getZero:function(){Te.get()}};function xe(e,t){Te.varargs=t;try{return Te.getStreamFromFD(),Te.get(),Te.get(),Te.get(),Te.get(),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function Ie(e,t){Te.varargs=t;try{var n=Te.getStreamFromFD(),r=Te.get(),o=Te.get();return Te.doReadv(n,r,o)}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function Fe(e,t){Te.varargs=t;try{for(var n=Te.get(),r=Te.get(),o=Te.get(),i=0,a=0;a<o;a++){for(var u=N[r+8*a>>2],s=N[r+(8*a+4)>>2],c=0;c<s;c++)Te.printChar(n,K[u+c]);i+=s}return i}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function ke(e){return t.___errno_location&&(N[t.___errno_location()>>2]=e),e}function Me(e,t){Te.varargs=t;try{return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function Ue(e,t){Te.varargs=t;try{var n=Te.getStr(),r=Te.get(),o=Te.get();return FS.open(n,r,o).fd}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function Ve(e,t){Te.varargs=t;try{return 0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function Le(e,t){Te.varargs=t;try{return Te.getStreamFromFD(),0}catch(e){return"undefined"!=typeof FS&&e instanceof FS.ErrnoError||Xt(e),-e.errno}}function De(){}function He(){t.abort()}function We(){return q.length}function ze(e){Xt("OOM")}function qe(e){e=Y(e,65536);var t=z.byteLength;try{return-1!==I.grow((e-t)/65536)&&(z=I.buffer,!0)}catch(e){return!1}}function Ke(e){var t=We();if(e>2147418112)return!1;for(var n=Math.max(t,16777216);n<e;)n=n<=536870912?Y(2*n,65536):Math.min(Y((3*n+2147483648)/4,65536),2147418112);return!!qe(n)&&(J(),!0)}function Ne(e){var t=Date.now();return N[e>>2]=t/1e3|0,N[e+4>>2]=t%1e3*1e3|0,0}var Ge=he;function Xe(e){return Math.pow(2,e)}function Ye(e){return Xe(e)}function Je(e){return Math.log(e)/Math.LN10}function Ze(e){return Je(e)}var Qe=me;function $e(e){var t=et,n=t.LLVM_SAVEDSTACKS[e];t.LLVM_SAVEDSTACKS.splice(e,1),Ft(n)}function et(){var e=et;return e.LLVM_SAVEDSTACKS||(e.LLVM_SAVEDSTACKS=[]),e.LLVM_SAVEDSTACKS.push(kt()),e.LLVM_SAVEDSTACKS.length-1}function tt(){Xt("trap!")}function nt(e,t){throw It(e,t||1),"longjmp"}function rt(e,t,n){K.set(K.subarray(t,t+n),e)}function ot(){return 11}function it(){}function at(){return 0}function ut(){}function st(){}function ct(){}function ft(){}function lt(e){switch(e){case 30:return G;case 85:return 2147418112/G;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===("undefined"==typeof navigator?"undefined":a(navigator))&&navigator.hardwareConcurrency||1}return ke(22),-1}function pt(e){var t=Date.now()/1e3|0;return e&&(N[e>>2]=t),t}function dt(e,t){var n=kt();try{return Mt(e,t)}catch(e){if(Ft(n),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function ht(e,t){var n=kt();try{return Ut(e,t)}catch(e){if(Ft(n),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function mt(e,t,n){var r=kt();try{return Vt(e,t,n)}catch(e){if(Ft(r),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function yt(e,t,n,r,o){var i=kt();try{return Lt(e,t,n,r,o)}catch(e){if(Ft(i),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function _t(e,t,n,r,o,i,a,u,s){var c=kt();try{return Dt(e,t,n,r,o,i,a,u,s)}catch(e){if(Ft(c),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function vt(e,t,n,r,o,i,a,u){var s=kt();try{return Ht(e,t,n,r,o,i,a,u)}catch(e){if(Ft(s),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function bt(e,t){var n=kt();try{Wt(e,t)}catch(e){if(Ft(n),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function gt(e,t,n){var r=kt();try{zt(e,t,n)}catch(e){if(Ft(r),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function wt(e,t,n,r,o){var i=kt();try{qt(e,t,n,r,o)}catch(e){if(Ft(i),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}function At(e,t,n,r,o,i,a,u,s,c){var f=kt();try{Kt(e,t,n,r,o,i,a,u,s,c)}catch(e){if(Ft(f),e!==e+0&&"longjmp"!==e)throw e;It(1,0)}}var St={},Bt={e:Xt,c:M,b:U,G:dt,F:ht,m:mt,E:yt,X:_t,I:vt,i:bt,s:gt,o:wt,H:At,f:Re,W:je,v:Oe,D:ke,V:xe,U:Ie,C:Fe,B:Me,T:Ue,A:Ve,z:Le,u:De,S:He,R:Pe,Q:We,P:rt,O:Ke,g:Ne,y:Ge,t:Ye,r:Ze,N:Qe,h:$e,l:et,M:tt,d:nt,x:ot,q:it,w:at,k:ut,p:st,j:ct,n:ft,L:lt,K:pt,J:ze,a:Q},Ct=t.asm(St,Bt,z);t.asm=Ct,t.___em_js__emscriptenPushBuffer=function(){return t.asm.Y.apply(null,arguments)};var Et=t._emscripten_bind_Container_Container_0=function(){return t.asm.Z.apply(null,arguments)},Pt=t._emscripten_bind_Container___destroy___0=function(){return t.asm._.apply(null,arguments)},Rt=t._emscripten_bind_Container_initAudio_3=function(){return t.asm.$.apply(null,arguments)},jt=t._emscripten_bind_Container_initVideo_5=function(){return t.asm.aa.apply(null,arguments)},Ot=t._emscripten_bind_Container_writeAudioFrame_3=function(){return t.asm.ba.apply(null,arguments)},Tt=t._emscripten_bind_Container_writeVideoFrame_1=function(){return t.asm.ca.apply(null,arguments)},xt=t._emscripten_bind_VoidPtr___destroy___0=function(){return t.asm.da.apply(null,arguments)},It=(t._free=function(){return t.asm.ea.apply(null,arguments)},t._malloc=function(){return t.asm.fa.apply(null,arguments)},t._opus_encode_float=function(){return t.asm.ga.apply(null,arguments)},t._opus_encoder_create=function(){return t.asm.ha.apply(null,arguments)},t._opus_encoder_ctl=function(){return t.asm.ia.apply(null,arguments)},t._opus_encoder_destroy=function(){return t.asm.ja.apply(null,arguments)},t._setThrew=function(){return t.asm.ka.apply(null,arguments)}),Ft=(t._speex_resampler_destroy=function(){return t.asm.la.apply(null,arguments)},t._speex_resampler_init=function(){return t.asm.ma.apply(null,arguments)},t._speex_resampler_process_interleaved_float=function(){return t.asm.na.apply(null,arguments)},t.stackRestore=function(){return t.asm.za.apply(null,arguments)}),kt=t.stackSave=function(){return t.asm.Aa.apply(null,arguments)},Mt=t.dynCall_dd=function(){return t.asm.oa.apply(null,arguments)},Ut=t.dynCall_ii=function(){return t.asm.pa.apply(null,arguments)},Vt=t.dynCall_iii=function(){return t.asm.qa.apply(null,arguments)},Lt=t.dynCall_iiiii=function(){return t.asm.ra.apply(null,arguments)},Dt=t.dynCall_iiiiiiiii=function(){return t.asm.sa.apply(null,arguments)},Ht=t.dynCall_iiiijj=function(){return t.asm.ta.apply(null,arguments)},Wt=(t.dynCall_v=function(){return t.asm.ua.apply(null,arguments)},t.dynCall_vi=function(){return t.asm.va.apply(null,arguments)}),zt=t.dynCall_vii=function(){return t.asm.wa.apply(null,arguments)},qt=t.dynCall_viiii=function(){return t.asm.xa.apply(null,arguments)},Kt=t.dynCall_vijjjid=function(){return t.asm.ya.apply(null,arguments)};function Nt(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Gt(e){function n(){t.calledRun||(t.calledRun=!0,V||(se(),ce(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),fe()))}e=e||t.arguments,ye>0||(ue(),ye>0||t.calledRun||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),n()},1)):n()))}function Xt(e){throw t.onAbort&&t.onAbort(e),void 0!==e?(T(e),x(e),e=JSON.stringify(e)):e="",V=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(t.asm=Ct,t.then=function(e){if(t.calledRun)e(t);else{var n=t.onRuntimeInitialized;t.onRuntimeInitialized=function(){n&&n(),e(t)}}return t},Nt.prototype=new Error,Nt.prototype.constructor=Nt,ve=function e(){t.calledRun||Gt(),t.calledRun||(ve=e)},t.run=Gt,t.abort=Xt,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();function Yt(){}function Jt(e){return(e||Yt).__cache__}function Zt(e,t){var n=Jt(t),r=n[e];return r||((r=Object.create((t||Yt).prototype)).ptr=e,n[e]=r)}function Qt(e,t){return Zt(e.ptr,t)}function $t(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete Jt(e.__class__)[e.ptr]}function en(e,t){return e.ptr===t.ptr}function tn(e){return e.ptr}function nn(e){return e.__class__}function rn(){throw"cannot construct a VoidPtr, no constructor in IDL"}function on(){this.ptr=Et(),Jt(on)[this.ptr]=this}return t.noExitRuntime=!0,Gt(),Yt.prototype=Object.create(Yt.prototype),Yt.prototype.constructor=Yt,Yt.prototype.__class__=Yt,Yt.__cache__={},t.WrapperObject=Yt,t.getCache=Jt,t.wrapPointer=Zt,t.castObject=Qt,t.NULL=Zt(0),t.destroy=$t,t.compare=en,t.getPointer=tn,t.getClass=nn,rn.prototype=Object.create(Yt.prototype),rn.prototype.constructor=rn,rn.prototype.__class__=rn,rn.__cache__={},t.VoidPtr=rn,rn.prototype.__destroy__=rn.prototype.__destroy__=function(){var e=this.ptr;xt(e)},on.prototype=Object.create(Yt.prototype),on.prototype.constructor=on,on.prototype.__class__=on,on.__cache__={},t.Container=on,on.prototype.initAudio=on.prototype.initAudio=function(e,t,n){var r=this.ptr;e&&"object"===a(e)&&(e=e.ptr),t&&"object"===a(t)&&(t=t.ptr),n&&"object"===a(n)&&(n=n.ptr),Rt(r,e,t,n)},on.prototype.initVideo=on.prototype.initVideo=function(e,t,n,r,o){var i=this.ptr;e&&"object"===a(e)&&(e=e.ptr),t&&"object"===a(t)&&(t=t.ptr),n&&"object"===a(n)&&(n=n.ptr),r&&"object"===a(r)&&(r=r.ptr),o&&"object"===a(o)&&(o=o.ptr),jt(i,e,t,n,r,o)},on.prototype.writeAudioFrame=on.prototype.writeAudioFrame=function(e,t,n){var r=this.ptr;return e&&"object"===a(e)&&(e=e.ptr),t&&"object"===a(t)&&(t=t.ptr),n&&"object"===a(n)&&(n=n.ptr),!!Ot(r,e,t,n)},on.prototype.writeVideoFrame=on.prototype.writeVideoFrame=function(e){var t=this.ptr;return e&&"object"===a(e)&&(e=e.ptr),!!Tt(t,e)},on.prototype.__destroy__=on.prototype.__destroy__=function(){var e=this.ptr;Pt(e)},function(){function e(){}ae||pe(e)}(),t});"object"===a(t)&&"object"===a(o)?o.exports=l:void 0===(i=function(){return l}.apply(t,[]))||(o.exports=i)}).call(this,n(1),"/",n(2)(e))},function(e,t,n){(function(e,r,o){var i;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var f,l=(f="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){t=void 0!==(t=t||{})?t:{};var o=n(0),i=o.EmscriptenMemoryAllocator,s=2049,l=48e3,p=4e3,d=20,h=6,m=4,y=4096,_=0,v=4002,b=0,g=function(){function e(n){u(this,e);var r=n.sampleRate,o=n.channelCount,a=n.audioBitsPerSecond,s=n.videoBitsPerSecond,c=n.width,f=n.height,h=n.framerate;this.config={sampleRate:r,channelCount:o,width:c,height:f,framerate:h},this.memory=new i(t),o>0&&(this._opus_encoder_create=t._opus_encoder_create,this._opus_encoder_ctl=t._opus_encoder_ctl,this._opus_encode_float=t._opus_encode_float,this._opus_encoder_destroy=t._opus_encoder_destroy,this._speex_resampler_init=t._speex_resampler_init,this._speex_resampler_process_interleaved_float=t._speex_resampler_process_interleaved_float,this._speex_resampler_destroy=t._speex_resampler_destroy),this._container=new t.Container,this._container.initVideo(1,h,c,f,s),o>0&&(this._container.initAudio(l,o,Math.floor(4294967295*Math.random())),this.OpusInitCodec(l,o,a),this.SpeexInitResampler(r,l,o),this.inputSamplesPerChannel=r*d/1e3,this.outputSamplePerChannel=l*d/1e3),this.videoBuffer=this.memory.mallocUint8Buffer(c*f*m),o>0&&(this.inputBufferIndex=0,this.mInputBuffer=this.memory.mallocFloat32Buffer(this.inputSamplesPerChannel*o),this.mResampledBuffer=this.memory.mallocFloat32Buffer(this.outputSamplePerChannel*o),this.mOutputBuffer=this.memory.mallocUint8Buffer(p),this.interleavedBuffers=1!==o?new Float32Array(y*o):void 0)}return c(e,[{key:"encode",value:function(e){for(var t=this.interleave(e),n=0;n<t.length;){var r=Math.min(this.mInputBuffer.length-this.inputBufferIndex,t.length-n);if(this.mInputBuffer.set(t.subarray(n,n+r),this.inputBufferIndex),this.inputBufferIndex+=r,this.inputBufferIndex>=this.mInputBuffer.length){var o=this.memory.mallocUint32(this.inputSamplesPerChannel),i=this.memory.mallocUint32(this.outputSamplePerChannel),a=this._speex_resampler_process_interleaved_float(this.resampler,this.mInputBuffer.pointer,o.pointer,this.mResampledBuffer.pointer,i.pointer);if(o.free(),i.free(),a!==b)throw new Error("Resampling error.");var u=this._opus_encode_float(this.encoder,this.mResampledBuffer.pointer,this.outputSamplePerChannel,this.mOutputBuffer.pointer,this.mOutputBuffer.length);if(u<0)throw new Error("Opus encoding error.");this._container.writeAudioFrame(this.mOutputBuffer.pointer,u,this.outputSamplePerChannel),this.inputBufferIndex=0}n+=r}}},{key:"encodeVideoFrame",value:function(e){this.videoBuffer.set(new Uint8Array(e.slice(0)),0),this._container.writeVideoFrame(this.videoBuffer.pointer)}},{key:"close",value:function(){for(var e=this.config.channelCount,n=[],r=0;r<e;++r)n.push(new Float32Array(y-this.inputBufferIndex/e));e>0&&this.encode(n),t.destroy(this._container),this.videoBuffer.free(),e>0&&(this.mInputBuffer.free(),this.mResampledBuffer.free(),this.mOutputBuffer.free(),this._opus_encoder_destroy(this.encoder),this._speex_resampler_destroy(this.resampler))}},{key:"interleave",value:function(e){var t=e.length;if(1===t)return e[0];for(var n=0;n<t;n++)for(var r=e[n],o=0;o<r.length;o++)this.interleavedBuffers[o*t+n]=r[o];return this.interleavedBuffers}},{key:"OpusInitCodec",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=this.memory.mallocUint32(void 0);this.encoder=this._opus_encoder_create(e,t,s,r.pointer);var o=r.value;if(r.free(),o!==_)throw new Error("Opus encodor initialization failed.");n&&this.OpusSetOpusControl(v,n)}},{key:"OpusSetOpusControl",value:function(e,t){var n=this.memory.mallocInt32(t);this._opus_encoder_ctl(this.encoder,e,n.pointer),n.free()}},{key:"SpeexInitResampler",value:function(e,t,n){var r=this.memory.mallocUint32(void 0);this.resampler=this._speex_resampler_init(n,e,t,h,r.pointer);var o=r.value;if(r.free(),o!==b)throw new Error("Initializing resampler failed.")}}]),e}();t.init=function(e){var n=e.sampleRate,r=e.channelCount,o=e.audioBitsPerSecond,i=e.videoBitsPerSecond,a=e.width,u=e.height,s=e.framerate;t.encodedBuffers=[],t.encoder=new g({sampleRate:n,channelCount:r,audioBitsPerSecond:o,videoBitsPerSecond:i,width:a,height:u,framerate:s})},t.encode=function(e){t.encoder.encode(e)},t.encodeVideoFrame=function(e){t.encoder&&t.encoder.encodeVideoFrame(e)},t.flush=function(){return t.encodedBuffers.splice(0,t.encodedBuffers.length)},t.close=function(){t.encoder.close()};var w,A={};for(w in t)t.hasOwnProperty(w)&&(A[w]=t[w]);t.arguments=[],t.thisProgram="./this.program",t.quit=function(e,t){throw t},t.preRun=[],t.postRun=[];var S=!1,B=!1,C=!1,E=!1;S="object"===("undefined"==typeof window?"undefined":a(window)),B="function"==typeof importScripts,C="object"===(void 0===e?"undefined":a(e))&&!S&&!B,E=!S&&!C&&!B;var P,R,j="";function O(e){return t.locateFile?t.locateFile(e,j):j+e}C?(j=r+"/",t.read=function(e,t){var r;return P||(P=n(3)),R||(R=n(4)),e=R.normalize(e),r=P.readFileSync(e),t?r:r.toString()},t.readBinary=function(e){var n=t.read(e,!0);return n.buffer||(n=new Uint8Array(n)),M(n.buffer),n},e.argv.length>1&&(t.thisProgram=e.argv[1].replace(/\\/g,"/")),t.arguments=e.argv.slice(2),e.on("uncaughtException",function(e){if(!(e instanceof $e))throw e}),e.on("unhandledRejection",tt),t.quit=function(t){e.exit(t)},t.inspect=function(){return"[Emscripten Module object]"}):E?("undefined"!=typeof read&&(t.read=function(e){return read(e)}),t.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(M("object"===a(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?t.arguments=scriptArgs:void 0!==arguments&&(t.arguments=arguments),"function"==typeof quit&&(t.quit=function(e){quit(e)})):(S||B)&&(B?j=self.location.href:document.currentScript&&(j=document.currentScript.src),f&&(j=f),j=0!==j.indexOf("blob:")?j.substr(0,j.lastIndexOf("/")+1):"",t.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},B&&(t.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),t.readAsync=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},t.setWindowTitle=function(e){document.title=e});var T=t.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),x=t.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||T);for(w in A)A.hasOwnProperty(w)&&(t[w]=A[w]);A=void 0;var I,F={"f64-rem":function(e,t){return e%t},debugger:function(){}};new Array(0),"object"!==("undefined"==typeof WebAssembly?"undefined":a(WebAssembly))&&x("no native wasm support detected");var k=!1;function M(e,t){e||tt("Assertion failed: "+t)}var U="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function V(e,t,n){for(var r=t+n,o=t;e[o]&&!(o>=r);)++o;if(o-t>16&&e.subarray&&U)return U.decode(e.subarray(t,o));for(var i="";t<o;){var a=e[t++];if(128&a){var u=63&e[t++];if(192!=(224&a)){var s=63&e[t++];if((a=224==(240&a)?(15&a)<<12|u<<6|s:(7&a)<<18|u<<12|s<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var c=a-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&a)<<6|u)}else i+=String.fromCharCode(a)}return i}function L(e,t){return e?V(W,e,t):""}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var D,H,W,z,q=65536;function K(e,t){return e%t>0&&(e+=t-e%t),e}function N(){t.HEAP8=H=new Int8Array(D),t.HEAP16=new Int16Array(D),t.HEAP32=z=new Int32Array(D),t.HEAPU8=W=new Uint8Array(D),t.HEAPU16=new Uint16Array(D),t.HEAPU32=new Uint32Array(D),t.HEAPF32=new Float32Array(D),t.HEAPF64=new Float64Array(D)}var G=5281856,X=38944,Y=5242880,J=t.TOTAL_MEMORY||16777216;function Z(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var r=n.func;"number"==typeof r?void 0===n.arg?t.dynCall_v(r):t.dynCall_vi(r,n.arg):r(void 0===n.arg?null:n.arg)}else n()}}J<Y&&x("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+J+"! (TOTAL_STACK="+Y+")"),t.buffer?D=t.buffer:"object"===("undefined"==typeof WebAssembly?"undefined":a(WebAssembly))&&"function"==typeof WebAssembly.Memory?(I=new WebAssembly.Memory({initial:J/q}),D=I.buffer):D=new ArrayBuffer(J),N(),z[X>>2]=G;var Q=[],$=[],ee=[],te=[],ne=!1;function re(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)ue(t.preRun.shift());Z(Q)}function oe(){ne||(ne=!0,Z($))}function ie(){Z(ee)}function ae(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)ce(t.postRun.shift());Z(te)}function ue(e){Q.unshift(e)}function se(e){ee.unshift(e)}function ce(e){te.unshift(e)}var fe=Math.cos,le=Math.sin,pe=0,de=null,he=null;function me(e){pe++,t.monitorRunDependencies&&t.monitorRunDependencies(pe)}function ye(e){if(pe--,t.monitorRunDependencies&&t.monitorRunDependencies(pe),0==pe&&(null!==de&&(clearInterval(de),de=null),he)){var n=he;he=null,n()}}t.preloadedImages={},t.preloadedAudios={};var _e="data:application/octet-stream;base64,";function ve(e){return String.prototype.startsWith?e.startsWith(_e):0===e.indexOf(_e)}var be="OggOpusEncoder.wasm";function ge(){try{if(t.wasmBinary)return new Uint8Array(t.wasmBinary);if(t.readBinary)return t.readBinary(be);throw"both async and sync fetching of the wasm failed"}catch(e){tt(e)}}function we(){return t.wasmBinary||!S&&!B||"function"!=typeof fetch?new Promise(function(e,t){e(ge())}):fetch(be,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+be+"'";return e.arrayBuffer()}).catch(function(){return ge()})}function Ae(e){var n={env:e,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:F};function r(e,n){var r=e.exports;t.asm=r,ye()}if(me(),t.instantiateWasm)try{return t.instantiateWasm(n,r)}catch(e){return x("Module.instantiateWasm callback failed with error: "+e),!1}function o(e){r(e.instance)}function i(e){we().then(function(e){return WebAssembly.instantiate(e,n)}).then(e,function(e){x("failed to asynchronously prepare wasm: "+e),tt(e)})}return t.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||ve(be)||"function"!=typeof fetch?i(o):WebAssembly.instantiateStreaming(fetch(be,{credentials:"same-origin"}),n).then(o,function(e){x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),i(o)}),{}}function Se(e,n){var r=new Uint8Array(t.HEAPU8.buffer,e,n);t.encodedBuffers.push(new Uint8Array(r).buffer)}function Be(e,t,n,r){tt("Assertion failed: "+L(e)+", at: "+[t?L(t):"unknown filename",n,r?L(r):"unknown function"])}function Ce(){throw k=!0,"Pure virtual function called!"}function Ee(){t.abort()}function Pe(){return H.length}function Re(e){tt("OOM")}function je(e){e=K(e,65536);var t=D.byteLength;try{return-1!==I.grow((e-t)/65536)&&(D=I.buffer,!0)}catch(e){return!1}}function Oe(e){var t=Pe();if(e>2147418112)return!1;for(var n=Math.max(t,16777216);n<e;)n=n<=536870912?K(2*n,65536):Math.min(K((3*n+2147483648)/4,65536),2147418112);return!!je(n)&&(N(),!0)}ve(be)||(be=O(be)),t.asm=function(e,t,n){return t.memory=I,t.table=new WebAssembly.Table({initial:46,maximum:46,element:"anyfunc"}),t.__memory_base=1024,t.__table_base=0,Ae(t)};var Te=fe;function xe(e){return Math.pow(2,e)}function Ie(e){return xe(e)}function Fe(e){return Math.log(e)/Math.LN10}function ke(e){return Fe(e)}var Me=le;function Ue(e){var t=Ve,n=t.LLVM_SAVEDSTACKS[e];t.LLVM_SAVEDSTACKS.splice(e,1),Ze(n)}function Ve(){var e=Ve;return e.LLVM_SAVEDSTACKS||(e.LLVM_SAVEDSTACKS=[]),e.LLVM_SAVEDSTACKS.push(Qe()),e.LLVM_SAVEDSTACKS.length-1}function Le(e,t,n){W.set(W.subarray(t,t+n),e)}function De(e){return t.___errno_location&&(z[t.___errno_location()>>2]=e),e}var He={},We={d:tt,b:Be,m:Ce,j:De,i:Ee,h:Se,l:Pe,q:Le,p:Oe,k:Te,g:Ie,f:ke,o:Me,c:Ue,e:Ve,n:Re,a:X},ze=t.asm(He,We,D);t.asm=ze,t.___em_js__emscriptenPushBuffer=function(){return t.asm.r.apply(null,arguments)};var qe=t._emscripten_bind_Container_Container_0=function(){return t.asm.s.apply(null,arguments)},Ke=t._emscripten_bind_Container___destroy___0=function(){return t.asm.t.apply(null,arguments)},Ne=t._emscripten_bind_Container_initAudio_3=function(){return t.asm.u.apply(null,arguments)},Ge=t._emscripten_bind_Container_initVideo_5=function(){return t.asm.v.apply(null,arguments)},Xe=t._emscripten_bind_Container_writeAudioFrame_3=function(){return t.asm.w.apply(null,arguments)},Ye=t._emscripten_bind_Container_writeVideoFrame_1=function(){return t.asm.x.apply(null,arguments)},Je=t._emscripten_bind_VoidPtr___destroy___0=function(){return t.asm.y.apply(null,arguments)},Ze=(t._free=function(){return t.asm.z.apply(null,arguments)},t._malloc=function(){return t.asm.A.apply(null,arguments)},t._opus_encode_float=function(){return t.asm.B.apply(null,arguments)},t._opus_encoder_create=function(){return t.asm.C.apply(null,arguments)},t._opus_encoder_ctl=function(){return t.asm.D.apply(null,arguments)},t._opus_encoder_destroy=function(){return t.asm.E.apply(null,arguments)},t._speex_resampler_destroy=function(){return t.asm.F.apply(null,arguments)},t._speex_resampler_init=function(){return t.asm.G.apply(null,arguments)},t._speex_resampler_process_interleaved_float=function(){return t.asm.H.apply(null,arguments)},t.stackRestore=function(){return t.asm.K.apply(null,arguments)}),Qe=t.stackSave=function(){return t.asm.L.apply(null,arguments)};function $e(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function et(e){function n(){t.calledRun||(t.calledRun=!0,k||(oe(),ie(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),ae()))}e=e||t.arguments,pe>0||(re(),pe>0||t.calledRun||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),n()},1)):n()))}function tt(e){throw t.onAbort&&t.onAbort(e),void 0!==e?(T(e),x(e),e=JSON.stringify(e)):e="",k=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(t.dynCall_v=function(){return t.asm.I.apply(null,arguments)},t.dynCall_vi=function(){return t.asm.J.apply(null,arguments)},t.asm=ze,t.then=function(e){if(t.calledRun)e(t);else{var n=t.onRuntimeInitialized;t.onRuntimeInitialized=function(){n&&n(),e(t)}}return t},$e.prototype=new Error,$e.prototype.constructor=$e,he=function e(){t.calledRun||et(),t.calledRun||(he=e)},t.run=et,t.abort=tt,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();function nt(){}function rt(e){return(e||nt).__cache__}function ot(e,t){var n=rt(t),r=n[e];return r||((r=Object.create((t||nt).prototype)).ptr=e,n[e]=r)}function it(e,t){return ot(e.ptr,t)}function at(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete rt(e.__class__)[e.ptr]}function ut(e,t){return e.ptr===t.ptr}function st(e){return e.ptr}function ct(e){return e.__class__}function ft(){throw"cannot construct a VoidPtr, no constructor in IDL"}function lt(){this.ptr=qe(),rt(lt)[this.ptr]=this}return t.noExitRuntime=!0,et(),nt.prototype=Object.create(nt.prototype),nt.prototype.constructor=nt,nt.prototype.__class__=nt,nt.__cache__={},t.WrapperObject=nt,t.getCache=rt,t.wrapPointer=ot,t.castObject=it,t.NULL=ot(0),t.destroy=at,t.compare=ut,t.getPointer=st,t.getClass=ct,ft.prototype=Object.create(nt.prototype),ft.prototype.constructor=ft,ft.prototype.__class__=ft,ft.__cache__={},t.VoidPtr=ft,ft.prototype.__destroy__=ft.prototype.__destroy__=function(){var e=this.ptr;Je(e)},lt.prototype=Object.create(nt.prototype),lt.prototype.constructor=lt,lt.prototype.__class__=lt,lt.__cache__={},t.Container=lt,lt.prototype.initAudio=lt.prototype.initAudio=function(e,t,n){var r=this.ptr;e&&"object"===a(e)&&(e=e.ptr),t&&"object"===a(t)&&(t=t.ptr),n&&"object"===a(n)&&(n=n.ptr),Ne(r,e,t,n)},lt.prototype.initVideo=lt.prototype.initVideo=function(e,t,n,r,o){var i=this.ptr;e&&"object"===a(e)&&(e=e.ptr),t&&"object"===a(t)&&(t=t.ptr),n&&"object"===a(n)&&(n=n.ptr),r&&"object"===a(r)&&(r=r.ptr),o&&"object"===a(o)&&(o=o.ptr),Ge(i,e,t,n,r,o)},lt.prototype.writeAudioFrame=lt.prototype.writeAudioFrame=function(e,t,n){var r=this.ptr;return e&&"object"===a(e)&&(e=e.ptr),t&&"object"===a(t)&&(t=t.ptr),n&&"object"===a(n)&&(n=n.ptr),!!Xe(r,e,t,n)},lt.prototype.writeVideoFrame=lt.prototype.writeVideoFrame=function(e){var t=this.ptr;return e&&"object"===a(e)&&(e=e.ptr),!!Ye(t,e)},lt.prototype.__destroy__=lt.prototype.__destroy__=function(){var e=this.ptr;Ke(e)},function(){function e(){}ne||se(e)}(),t});"object"===a(t)&&"object"===a(o)?o.exports=l:void 0===(i=function(){return l}.apply(t,[]))||(o.exports=i)}).call(this,n(1),"/",n(2)(e))}]);}});